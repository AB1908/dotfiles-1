#!/bin/sh
#
# Spotify wrapper. Features:
# - Only allow one instance.
# - Skip ads.
#
# Author: Rafael Cavalcanti - rafaelc.org

if wmctrl -xl | grep -q spotify.Spotify; then
  printf "Spotify is already running.\n"
  exit 1
fi

# Launch ad skipper
while true; do
  if [ "$(playerctl metadata title)" = "Advertisement" ] && [ "$(playerctl status)" = "Playing" ]; then
    playerctl next && notify-send --urgency=low "Spotify" "Attempted to skip Spotify ad."
  fi
  sleep 2s
done &

# Kill ad skipper on exit
trap 'kill $!' EXIT

flatpak run com.spotify.Client

