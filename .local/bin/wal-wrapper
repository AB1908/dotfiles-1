#!/usr/bin/env bash
#
# Wrapper script for pywal, doing all the extra needed
# operations for using a new colorscheme.
#
# Copyright (C) 2020 Rafael Cavalcanti - rafaelc.org
# Licensed under GPLv3

set -euo pipefail

export SUDO_ASKPASS="$HOME/.local/bin/dmenu_pass"

wal "$@"

printf "\nRecompiling dwm...\n"
# Remove urg_ variables as we don't use the urgent patch.
sed -i '/ urg_/d' ~/.cache/wal/colors-wal-dwm.h
cd ~/Code/dwm && sudo -A make clean install > /dev/null

printf "\nRecompiling dmenu...\n"
cd ~/Code/dmenu && sudo -A make clean install > /dev/null

printf "\nRestarting dunst...\n"
killall dunst || true
dunst &
disown

dmenu_confirm "Restart dwm to apply changes?" "killall -HUP dwm"
